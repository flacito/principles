---
import "../styles/global.css";

interface Props {
  title: string;
}

const { title } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Principles for building systems from small, honest, self-describing capabilities." />
    <link rel="icon" type="image/svg+xml" href={`${base}favicon.svg`} />
    <title>{title}</title>
    <script is:inline>
      (function () {
        const saved = localStorage.getItem("theme");
        if (saved) document.documentElement.setAttribute("data-theme", saved);
      })();
    </script>
  </head>
  <body>
    <nav class="site-nav">
      <a href={base}>Principles</a>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
        <span id="theme-icon"></span>
      </button>
    </nav>
    <main>
      <slot />
    </main>
    <footer class="site-footer">
      <a href={`${base}attribution`}>Kesler, Webb &amp; Claude</a> &middot;
      <a href="https://github.com/flacito/principles">Source</a>
    </footer>
    <script is:inline>
      (function () {
        const btn = document.getElementById("theme-toggle");
        const icon = document.getElementById("theme-icon");

        function getEffective() {
          const saved = localStorage.getItem("theme");
          if (saved) return saved;
          return window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";
        }

        function updateIcon() {
          const t = getEffective();
          icon.textContent = t === "dark" ? "\u2600" : "\u263E";
        }

        btn.addEventListener("click", function () {
          const current = getEffective();
          const next = current === "dark" ? "light" : "dark";
          document.documentElement.setAttribute("data-theme", next);
          localStorage.setItem("theme", next);
          updateIcon();
        });

        updateIcon();

        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", function () {
            if (!localStorage.getItem("theme")) updateIcon();
          });
      })();
    </script>
  </body>
</html>
